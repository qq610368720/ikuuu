name: "iKuuu æœºåœºè‡ªåŠ¨ç­¾åˆ°"

jobs:
  checkin:
    steps:
      # ...å…¶ä»–æ­¥éª¤ä¿æŒä¸å˜...

      - name: ğŸ“¢ æ¨é€çŠ¶æ€é€šçŸ¥
        if: always()
        env:
          SCKEY: ${{ secrets.SCKEY }}
          TOKEN: ${{ secrets.TOKEN }}
        shell: bash
        run: |
          set -euo pipefail
          sudo apt-get -qq update && sudo apt-get -qq install -y jq
          
          status="${{ job.status }}"
          timestamp=$(date '+%Y-%m-%d %H:%M:%S')

          # Serveré…±æ¨é€
          if [[ -n "$SCKEY" && "$SCKEY" != "1" ]]; then
            encoded_title=$(jq -nr --arg status "$status" 'ç­¾åˆ°\($status)|@uri')
            encoded_descr=$(jq -nr --arg ts "$timestamp" 'æ‰§è¡Œæ—¶é—´ï¼š\($ts)|@uri')
            
            curl -s -G "https://sctapi.ftqq.com/$SCKEY.send" \
              --data-urlencode "title=$encoded_title" \
              --data-urlencode "descr=$encoded_descr" \
              --fail-with-body
          fi

          # PushPlusæ¨é€
          if [[ -n "$TOKEN" && "$TOKEN" != "1" ]]; then
            json_data=$(jq -n \
              --arg token "$TOKEN" \
              --arg title "ç­¾åˆ°${status}" \
              --arg content "æ‰§è¡Œæ—¶é—´ï¼š${timestamp}" \
              '{token: $token, title: $title, content: $content}')
            
            curl -s -X POST "http://www.pushplus.plus/send" \
              -H "Content-Type: application/json" \
              -d "$json_data" \
              --fail-with-body
          fi
