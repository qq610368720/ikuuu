- name: ğŸ“¢ æ¨é€é€šçŸ¥
  if: always()
  env:
    SCKEY: ${{ secrets.SCKEY }}
    TOKEN: ${{ secrets.TOKEN }}
  shell: bash
  run: |
    # å®‰è£…å¿…è¦å·¥å…·ï¼ˆjqï¼‰
    sudo apt-get -qq update && sudo apt-get -qq install jq

    # è·å–ä»»åŠ¡çŠ¶æ€
    status="${{ job.status }}"
    timestamp=$(date '+%m-%d %H:%M:%S')

    # Serveré…±æ¨é€
    if [[ -n "$SCKEY" && "$SCKEY" != "1" ]]; then
      echo "â†’ å‘é€Serveré…±é€šçŸ¥"
      encoded_title="$(echo "ç­¾åˆ°${status}" | jq -Rr @uri)"
      encoded_descr="$(echo "æ—¶é—´ï¼š${timestamp}" | jq -Rr @uri)"
      
      curl_response=$(curl -s -o /dev/null -w "%{http_code}" \
        -G "https://sctapi.ftqq.com/$SCKEY.send" \
        --data-urlencode "title=$encoded_title" \
        --data-urlencode "descr=$encoded_descr")
      
      echo "Serveré…±è¿”å›çŠ¶æ€ç ï¼š$curl_response"
    fi

    # PushPlusæ¨é€
    if [[ -n "$TOKEN" && "$TOKEN" != "1" ]]; then
      echo "â†’ å‘é€PushPlusé€šçŸ¥"
      json_payload=$(jq -n \
        --arg token "$TOKEN" \
        --arg title "ç­¾åˆ°${status}" \
        --arg content "æ—¶é—´ï¼š${timestamp}" \
        '{token: $token, title: $title, content: $content}')
      
      curl_response=$(curl -s -o /dev/null -w "%{http_code}" \
        -X POST "http://www.pushplus.plus/send" \
        -H "Content-Type: application/json" \
        -d "$json_payload")
      
      echo "PushPlusè¿”å›çŠ¶æ€ç ï¼š$curl_response"
    fi
